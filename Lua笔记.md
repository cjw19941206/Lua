# 一、Lua语言入门

>    安装**Lua解释器**分为两种方法：
>
>   1.   下载源码然后编译成二进制文件 `make ...`
>   2.   直接下载可运行的二进制文件，然后在环境变量Path中添加该二进制文件所处的文件夹位置

## 1 程序段

**程序段**：一个文件或者交互模式下的一行

从5.3版本开始，在**交互模式**下可以直接输出表达式的值，而之前的版本需要在表达式前面加上`=`

**独立解释器**的各种参数：



## 2 词法规范

Lua的**保留字**：![image-20220428001510411](../pic/image-20220428001510411.png)

**注释**：

-   单行注释：`-- 注释内容`
-   多行注释：`-- [[ 注释内容 ]]`



## 3 全局变量

只要是没有声明为local的变量都默认是全局变量，且**全局变量无需声明就可以使用**，不过值为`nil`。

Lua不会区分未初始化的变量和值为nil的变量，当一个变量为nil后，Lua会最终回收该变量占用的内存





## 4 类型和值

>    Lua是动态类型语言，无需定义变量的类型

![image-20220428002530287](../pic/image-20220428002530287.png)



## 5 独立解释器

 Lua命令的完整参数形如：`lua [options] [script [args]]`

解释器处理参数前`LUA_INIT`：

![image-20220428004036964](../pic/image-20220428004036964.png)

解释器处理参数时`arg`：

![image-20220428004607798](../pic/image-20220428004607798.png)






# 二、八种类型

## 1 nil

nil类型只有一个值nil，主要就是用于和其它值进行区分。当全局变量被赋值为nil后，最终会导致该变量被回收内存空间。

## 2 boolean

boolean类型有两个值：true和false

-   false：fasle和nil
-   true：其他所有的值

**逻辑运算符**：and、or和not

-   `a and b or c`：

    ```lua
    if a then
    	return b
    else 
    	return c
    end
    ```

-   `a = a or b`：常用于不能确定a是否是nil时给a初始化

    ```lua
    if not a then
        a = b
    end
    ```

-   `not a`：永远返回boolean类型的值



## 3 number

对于Lua5.3之前的版本，所有的数值都是**双精度浮点数**。从Lua5.3开始，为数值提供了两种选择：integer（**64位整型**）和float（**双精度浮点数**），对于资源受限的平台，会编译为 Small Lua 模式，使用32位整型和单精度浮点数。

### 3.1 数值常量

-   具有十进制小数或者指数的数值会被当作float，否则是integer
-   float和integer的类型都是number，他们可以相互转化。并且具有相同算数值的integer和float是相等的
-   可以通过`math.type`来区分integer和float
-   支持0x开头的16进制常量，并且还支持16进制的浮点数



### 3.2 算术运算

```lua
1 + 1 --> 	2
1.0 + 1.0 --> 	2.0
1 + 1.0 --> 	2.0
5 / 2 --> 	2.5
5.0 / 2 -->	2.5
5 // 2 -->	2.5
5.0 // 2 -->	2.5
4.0 / 2.0 -->	2.5
3.1415 - 3.1415 % 0.01 --> 	3.14
2 ^ 3 -->	8.0
2 ^ 3.1 -->	8.5741877002903
8 ^ (1 / 3) -->	2.0
```



 ### 3.3 关系运算

![image-20220429004128389](../pic/image-20220429004128389.png)



### 3.4 表示范围

![image-20220429005059369](../pic/image-20220429005059369.png)

![image-20220429005407362](../pic/image-20220429005407362.png)

-   将integer转换为float：`+ 0.0`

-   将float转换为integer：

    -   `|0`：在转化时会检查是否是小数并且值在整型值的表示范围内，不满足就会抛出异常

    -   `math.tointeger()`：该函数会在输入 参数无法转换为整型值时返回 nil

        

        

### 3.5 运算符优先级

>   应该尽量使用括号`()`，而不是考虑运算符的优先级

![image-20220429010617747](../pic/image-20220429010617747.png)



### 3.6 兼容性问题

![image-20220429011149535](../pic/image-20220429011149535.png)

## 4 string

>   Lua中的string既可以表示单个字符，也可以表示字符串，既可以用单引号`''`也可以用 双引号`""`

string 是不可变值，只能通过创建一个新的 string 来达到修改的目的，并且Lua会负责string的分配和释放。

获取字符串的长度可以通过 `#str`来实现，它返回的是该string的**字节数**。

连接字符串可以通过`str1 .. str2`来实现，如果操作数中存在数值，则会把该数值转换为字符串然后进行连接操作：

`print(1 .. 2) --> "12"`



### 4.1 多行字符串

```lua
page = [[
<html>
<head>
	<title> An HTML Page </title>
</head>
...
]]

print(page)
```

`\z`转义字符能够跳过所有的空白字符，直到遇到第一个非空白字符



### 4.2 强制类型转换

-   自动强制类型转换：

    ```lua
    print(1 .. 2) --> "12"
    print("10" + 2) --> 12  默认是浮点数
    ```

-   手动强制类型转换：

    ```lua
    ------- tonumber --------
    print(tonumber(" -3")) --> -3
    print(tonumber(" -3e")) --> nil
    print(tonumber(" -3e1")) --> -30.0
    print(tonumber("fff", 16)) --> 4095
    print(tonumber("987", 8)) --> nil
    ------- tostring ---------
    print(tostring(12)) --> "12"
    print(tostring(12) == "12") --> true
    ```

-   比较运算符不会进行类型转换：

    ```lua
    print(2 < 15) --> true
    print("2" < "15") --> false
    print(2 < "15") --> 异常
    ```



### 4.3 Unicode和UTF-8

>   TODO



## 5 table

>   表  Table 是 Lua 语言中**唯一**的数据结构



### 5.1 table的操作





## 6 function



## 7 userdata









## 8 thread











# 标准库

## 数学标准库math







## 字符串标准库





